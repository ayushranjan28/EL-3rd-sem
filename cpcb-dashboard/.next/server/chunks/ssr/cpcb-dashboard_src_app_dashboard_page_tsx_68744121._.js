module.exports=[69997,a=>{"use strict";var b=a.i(98144),c=a.i(99812),d=a.i(83586),e=a.i(7215);function f({onPrediction:a}){let[d,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)({factory_id:"TX-B",factory_type:"Textile",location_km_from_origin:15,flow_rate_m3ph:350,turbidity_ntu:200,ph:7,conductivity_us_cm:2e3,temperature_c:30,chromium_mg_l:.1,copper_mg_l:.5,tds_mg_l:1500,uv_vis_absorbance:.5}),m=async b=>{b.preventDefault(),f(!0),h(""),j(null);try{let b=await fetch("/api/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}),c=await b.json();c.success?(j(c.prediction),c.prediction.is_violation&&await n(c.prediction),a&&a(c.prediction)):h(c.error||"Prediction failed")}catch(a){h("Network error: "+a.message),console.error("Prediction error:",a)}finally{f(!1)}},n=async a=>{try{await fetch("/api/alerts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...k,is_violation:a.is_violation,violation_reason:a.violation_reasons.join("|"),ai_violation_score:a.violation_probability,alert_status:"pending",assigned_employee_id:"EMP-001"})})}catch(a){console.error("Failed to save alert:",a)}},o=(a,b)=>{l(c=>({...c,[a]:b}))};return(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{children:"ðŸ”¬ Sensor Data Input - AI Violation Detection"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Factory ID"}),(0,b.jsxs)("select",{value:k.factory_id,onChange:a=>o("factory_id",a.target.value),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800",children:[(0,b.jsx)("option",{value:"TX-A",children:"TX-A (Textile)"}),(0,b.jsx)("option",{value:"TX-B",children:"TX-B (Textile)"}),(0,b.jsx)("option",{value:"TX-C",children:"TX-C (Textile)"}),(0,b.jsx)("option",{value:"CH-1",children:"CH-1 (Chemical)"}),(0,b.jsx)("option",{value:"CH-2",children:"CH-2 (Chemical)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Factory Type"}),(0,b.jsxs)("select",{value:k.factory_type,onChange:a=>o("factory_type",a.target.value),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800",children:[(0,b.jsx)("option",{value:"Textile",children:"Textile"}),(0,b.jsx)("option",{value:"Chemical",children:"Chemical"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Turbidity (NTU) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"number",step:"0.01",value:k.turbidity_ntu,onChange:a=>o("turbidity_ntu",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800",required:!0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Threshold: >200"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["pH ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"number",step:"0.1",value:k.ph,onChange:a=>o("ph",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800",required:!0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Range: 5.5-9.0"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Chromium (mg/L) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"number",step:"0.001",value:k.chromium_mg_l,onChange:a=>o("chromium_mg_l",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800",required:!0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Threshold: >0.1"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Conductivity (Î¼S/cm)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:k.conductivity_us_cm,onChange:a=>o("conductivity_us_cm",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Temperature (Â°C)"}),(0,b.jsx)("input",{type:"number",step:"0.1",value:k.temperature_c,onChange:a=>o("temperature_c",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"TDS (mg/L)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:k.tds_mg_l,onChange:a=>o("tds_mg_l",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Threshold: >2100"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Copper (mg/L)"}),(0,b.jsx)("input",{type:"number",step:"0.001",value:k.copper_mg_l,onChange:a=>o("copper_mg_l",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"UV-Vis Absorbance"}),(0,b.jsx)("input",{type:"number",step:"0.001",value:k.uv_vis_absorbance,onChange:a=>o("uv_vis_absorbance",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Threshold: >1.0"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Flow Rate (mÂ³/h)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:k.flow_rate_m3ph,onChange:a=>o("flow_rate_m3ph",parseFloat(a.target.value)),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800"})]})]}),g&&(0,b.jsx)("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm",children:g}),(0,b.jsx)("button",{type:"submit",disabled:d,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,b.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing with AI..."]}):"ðŸ¤– Analyze with AI Model (99.57% Accuracy)"}),i&&(0,b.jsxs)("div",{className:`p-4 rounded-lg border-2 ${i.is_violation?"bg-red-50 border-red-500 dark:bg-red-900/20":"bg-green-50 border-green-500 dark:bg-green-900/20"}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-bold",children:i.is_violation?"âš ï¸ VIOLATION DETECTED":"âœ… COMPLIANT"}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${"critical"===i.alert_level?"bg-red-600 text-white":"high"===i.alert_level?"bg-orange-600 text-white":"medium"===i.alert_level?"bg-yellow-600 text-white":"bg-green-600 text-white"}`,children:i.alert_level.toUpperCase()})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"AI Confidence"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[(100*i.violation_probability).toFixed(1),"%"]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:(0,b.jsx)("div",{className:`h-2 rounded-full ${i.violation_probability>.7?"bg-red-600":"bg-green-600"}`,style:{width:`${100*i.violation_probability}%`}})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Model Confidence"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[(100*i.confidence).toFixed(1),"%"]})]})]}),i.violation_reasons.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Violation Reasons:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:i.violation_reasons.map((a,c)=>(0,b.jsx)("span",{className:"px-3 py-1 bg-red-200 text-red-900 rounded-full text-sm font-medium",children:a.replace(/_/g," ").toUpperCase()},c))})]}),i.is_violation&&(0,b.jsx)("div",{className:"mt-3 p-2 bg-yellow-100 dark:bg-yellow-900/20 rounded text-sm",children:"âœ“ Alert automatically saved to MongoDB and assigned to employee"})]})]})})]})}function g(){let a=(0,d.useRouter)(),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0);(0,c.useEffect)(()=>{let b=localStorage.getItem("user");b?(h(JSON.parse(b)),o()):a.push("/login")},[a]);let o=async()=>{try{let a=await fetch("/api/alerts?limit=50"),b=await a.json();if(b.success){let a=b.alerts;l(a);let c=a.length,d=a.filter(a=>"pending"===a.alert_status).length,e=a.filter(a=>"resolved"===a.alert_status).length,f=a.filter(a=>a.is_violation).length,g={};a.forEach(a=>{a.is_violation&&a.factory_id&&(g[a.factory_id]=(g[a.factory_id]||0)+1)});let h=Object.entries(g).map(([a,b])=>({factory:a,count:b})).sort((a,b)=>b.count-a.count).slice(0,5);j({totalAlerts:c,activeAlerts:d,resolvedAlerts:e,violationRate:c>0?f/c:0,topViolators:h})}}catch(a){console.error("Failed to fetch dashboard data:",a)}finally{n(!1)}};return m?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading dashboard..."})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,b.jsxs)("div",{className:"container mx-auto p-6",children:[(0,b.jsxs)("div",{className:"mb-8 flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Water Pollution Monitoring Dashboard"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Real-time monitoring with AI-powered violation detection"})]}),g&&(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.fullName||g.username}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[g.employeeId," â€¢ ",g.role]})]}),(0,b.jsx)("button",{onClick:()=>{localStorage.removeItem("user"),a.push("/login")},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Logout"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Alerts"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:i?.totalAlerts||0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"From MongoDB"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Alerts"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400",children:i?.activeAlerts||0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Pending action"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Resolved"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:i?.resolvedAlerts||0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Completed"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Violation Rate"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:[(100*(i?.violationRate||0)).toFixed(1),"%"]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"AI-detected"})]})]})]}),(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(f,{onPrediction:a=>{a.is_violation&&o()}})}),(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{children:"Recent Alerts (MongoDB)"})}),(0,b.jsx)(e.CardContent,{children:0===k.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No alerts yet. Submit sensor readings to generate alerts."}),(0,b.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Use the AI prediction API to analyze water quality data"})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Timestamp"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Factory"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Type"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"AI Score"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Violation"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-2 px-4 font-medium",children:"Assigned To"})]})}),(0,b.jsx)("tbody",{children:k.slice(0,10).map((a,c)=>(0,b.jsxs)("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,b.jsx)("td",{className:"py-3 px-4 text-xs",children:new Date(a.timestamp).toLocaleString()}),(0,b.jsx)("td",{className:"py-3 px-4 font-medium",children:a.factory_id}),(0,b.jsx)("td",{className:"py-3 px-4",children:a.factory_type}),(0,b.jsx)("td",{className:"py-3 px-4",children:(0,b.jsx)("span",{className:"font-mono",children:a.ai_violation_score?.toFixed(3)})}),(0,b.jsx)("td",{className:"py-3 px-4",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.is_violation?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:a.is_violation?"Violation":"Compliant"})}),(0,b.jsx)("td",{className:"py-3 px-4",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"pending"===a.alert_status?"bg-yellow-100 text-yellow-800":"acknowledged"===a.alert_status?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:a.alert_status})}),(0,b.jsx)("td",{className:"py-3 px-4 text-xs",children:a.assigned_employee_id||"-"})]},c))})]})})})]}),i&&i.topViolators.length>0&&(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{children:"Top Violators (from MongoDB data)"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:i.topViolators.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-24 font-medium",children:a.factory}),(0,b.jsx)("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:(0,b.jsx)("div",{className:"bg-red-600 h-4 rounded-full",style:{width:`${a.count/i.topViolators[0].count*100}%`}})}),(0,b.jsx)("div",{className:"w-16 text-right font-semibold",children:a.count})]},a.factory))})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Data Source"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:"MongoDB"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Real-time alerts & readings"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"AI Model"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:"99.57%"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Accuracy (trained on CSV)"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"API Status"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:"Active"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"http://localhost:5000"})]})]})]}),(0,b.jsxs)(e.Card,{className:"mt-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{children:"How to Use"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold mb-2",children:"1. Start AI Prediction API"}),(0,b.jsx)("code",{className:"block bg-gray-100 dark:bg-gray-800 p-2 rounded",children:"python api_server.py"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold mb-2",children:"2. Submit Sensor Readings"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Send water quality data to the AI API for violation detection"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold mb-2",children:"3. View Results"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Alerts are automatically saved to MongoDB and displayed here"})]})]})})]})]})})}a.s(["default",()=>g],69997)}];

//# sourceMappingURL=cpcb-dashboard_src_app_dashboard_page_tsx_68744121._.js.map