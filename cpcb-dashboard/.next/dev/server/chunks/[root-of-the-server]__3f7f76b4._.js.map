{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/pages/api/socket.ts"],"sourcesContent":["import { Server } from \"socket.io\";\r\nimport type { NextApiRequest, NextApiResponse } from \"next\";\r\n\r\n// Global variable to track interval across hot reloads in dev\r\nlet interval: NodeJS.Timeout | null = null;\r\n\r\nconst SocketHandler = (req: NextApiRequest, res: NextApiResponse | any) => {\r\n    if (res.socket.server.io) {\r\n        // Already running\r\n        res.end();\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing Socket.io server...\");\r\n    const io = new Server(res.socket.server, {\r\n        path: \"/api/socket\",\r\n        addTrailingSlash: false,\r\n    });\r\n    res.socket.server.io = io;\r\n\r\n    io.on(\"connection\", (socket) => {\r\n        console.log(\"Client connected:\", socket.id);\r\n    });\r\n\r\n    // Clear existing interval if any (for dev hot reload safety)\r\n    if (interval) clearInterval(interval);\r\n\r\n    // Simulate Industrial Data Stream\r\n    interval = setInterval(() => {\r\n        const factories = ['A', 'B', 'C'];\r\n        const payload = factories.map(f => ({\r\n            factory: f,\r\n            timestamp: new Date().toISOString(),\r\n            // Simulation logic:\r\n            // Factory A: High Turbidity often\r\n            // Factory B: Acidic pH often\r\n            // Factory C: Mostly Normal\r\n            turbidity: f === 'A' ? 180 + Math.random() * 50 : 100 + Math.random() * 50, // >200 is violation\r\n            ph: f === 'B' ? 6.0 + Math.random() * 1.5 : 6.8 + Math.random() * 1.0,      // <6.5 is violation\r\n            conductivity: 1200 + Math.random() * 300,\r\n        }));\r\n\r\n        io.emit(\"sensor-data\", payload);\r\n    }, 5000);\r\n\r\n    res.end();\r\n};\r\n\r\nexport default SocketHandler;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAGA,8DAA8D;AAC9D,IAAI,WAAkC;AAEtC,MAAM,gBAAgB,CAAC,KAAqB;IACxC,IAAI,IAAI,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE;QACtB,kBAAkB;QAClB,IAAI,GAAG;QACP;IACJ;IAEA,QAAQ,GAAG,CAAC;IACZ,MAAM,KAAK,IAAI,qLAAM,CAAC,IAAI,MAAM,CAAC,MAAM,EAAE;QACrC,MAAM;QACN,kBAAkB;IACtB;IACA,IAAI,MAAM,CAAC,MAAM,CAAC,EAAE,GAAG;IAEvB,GAAG,EAAE,CAAC,cAAc,CAAC;QACjB,QAAQ,GAAG,CAAC,qBAAqB,OAAO,EAAE;IAC9C;IAEA,6DAA6D;IAC7D,IAAI,UAAU,cAAc;IAE5B,kCAAkC;IAClC,WAAW,YAAY;QACnB,MAAM,YAAY;YAAC;YAAK;YAAK;SAAI;QACjC,MAAM,UAAU,UAAU,GAAG,CAAC,CAAA,IAAK,CAAC;gBAChC,SAAS;gBACT,WAAW,IAAI,OAAO,WAAW;gBACjC,oBAAoB;gBACpB,kCAAkC;gBAClC,6BAA6B;gBAC7B,2BAA2B;gBAC3B,WAAW,MAAM,MAAM,MAAM,KAAK,MAAM,KAAK,KAAK,MAAM,KAAK,MAAM,KAAK;gBACxE,IAAI,MAAM,MAAM,MAAM,KAAK,MAAM,KAAK,MAAM,MAAM,KAAK,MAAM,KAAK;gBAClE,cAAc,OAAO,KAAK,MAAM,KAAK;YACzC,CAAC;QAED,GAAG,IAAI,CAAC,eAAe;IAC3B,GAAG;IAEH,IAAI,GAAG;AACX;uCAEe"}}]
}