{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\r\n// MongoDB connection and utilities\r\n\r\nimport { MongoClient, Db } from 'mongodb';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n    throw new Error('Please add your MongoDB URI to .env.local');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\ndeclare global {\r\n    var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n}\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n    // In development mode, use a global variable to preserve the MongoClient across hot reloads\r\n    if (!global._mongoClientPromise) {\r\n        client = new MongoClient(uri, options);\r\n        global._mongoClientPromise = client.connect();\r\n    }\r\n    clientPromise = global._mongoClientPromise;\r\n} else {\r\n    // In production mode, create a new MongoClient\r\n    client = new MongoClient(uri, options);\r\n    clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n\r\n/**\r\n * Get database instance\r\n */\r\nexport async function getDatabase(): Promise<Db> {\r\n    const client = await clientPromise;\r\n    return client.db('water_pollution_db');\r\n}\r\n\r\n/**\r\n * Collections\r\n */\r\nexport const collections = {\r\n    users: 'users',\r\n    alerts: 'alerts',\r\n    readings: 'readings',\r\n};\r\n\r\n/**\r\n * User interface\r\n */\r\nexport interface User {\r\n    _id?: string;\r\n    username: string;\r\n    password: string; // hashed\r\n    role: 'admin' | 'employee';\r\n    employeeId: string;\r\n    createdAt: Date;\r\n}\r\n\r\n/**\r\n * Alert interface (matches CSV structure)\r\n */\r\nexport interface Alert {\r\n    _id?: string;\r\n    timestamp: string;\r\n    reading_id: string;\r\n    factory_id: string;\r\n    factory_type: string;\r\n    location_km_from_origin: number;\r\n    sensor_data: {\r\n        flow_rate_m3ph: number;\r\n        turbidity_ntu: number;\r\n        ph: number;\r\n        conductivity_us_cm: number;\r\n        temperature_c: number;\r\n        chromium_mg_l: number;\r\n        copper_mg_l: number;\r\n        tds_mg_l: number;\r\n        uv_vis_absorbance: number;\r\n    };\r\n    is_violation: boolean;\r\n    violation_reason: string;\r\n    ai_violation_score: number;\r\n    assigned_employee_id: string;\r\n    alert_status: 'none' | 'pending' | 'acknowledged' | 'resolved';\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\n/**\r\n * Reading interface (for real-time submissions)\r\n */\r\nexport interface Reading {\r\n    _id?: string;\r\n    timestamp: string;\r\n    factory_id: string;\r\n    factory_type: string;\r\n    sensor_data: Record<string, number>;\r\n    submitted_by: string;\r\n    createdAt: Date;\r\n}\r\n\r\n/**\r\n * Initialize database with seed data\r\n */\r\nexport async function initializeDatabase() {\r\n    const db = await getDatabase();\r\n\r\n    // Check if users exist\r\n    const usersCount = await db.collection(collections.users).countDocuments();\r\n\r\n    if (usersCount === 0) {\r\n        // Seed users\r\n        const bcrypt = require('bcryptjs');\r\n        const users: User[] = [\r\n            {\r\n                username: 'emp047',\r\n                password: await bcrypt.hash('emp123', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-001',\r\n                createdAt: new Date(),\r\n            },\r\n            {\r\n                username: 'emp048',\r\n                password: await bcrypt.hash('emp123', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-002',\r\n                createdAt: new Date(),\r\n            },\r\n            {\r\n                username: 'admin',\r\n                password: await bcrypt.hash('admin123', 10),\r\n                role: 'admin',\r\n                employeeId: 'ADMIN-001',\r\n                createdAt: new Date(),\r\n            },\r\n        ];\r\n\r\n        await db.collection(collections.users).insertMany(users);\r\n        console.log('✓ Seeded users');\r\n    }\r\n\r\n    // Create indexes\r\n    await db.collection(collections.alerts).createIndex({ timestamp: -1 });\r\n    await db.collection(collections.alerts).createIndex({ factory_id: 1 });\r\n    await db.collection(collections.alerts).createIndex({ alert_status: 1 });\r\n    await db.collection(collections.readings).createIndex({ timestamp: -1 });\r\n\r\n    console.log('✓ Database initialized');\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,iBAAiB;AACjB,mCAAmC;AAEnC;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC1B,MAAM,IAAI,MAAM;AACpB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAMJ,wCAA4C;IACxC,4FAA4F;IAC5F,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC7B,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC/C;IACA,gBAAgB,OAAO,mBAAmB;AAC9C;;uCAMe;AAKR,eAAe;IAClB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACrB;AAKO,MAAM,cAAc;IACvB,OAAO;IACP,QAAQ;IACR,UAAU;AACd;AA4DO,eAAe;IAClB,MAAM,KAAK,MAAM;IAEjB,uBAAuB;IACvB,MAAM,aAAa,MAAM,GAAG,UAAU,CAAC,YAAY,KAAK,EAAE,cAAc;IAExE,IAAI,eAAe,GAAG;QAClB,aAAa;QACb,MAAM;QACN,MAAM,QAAgB;YAClB;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,UAAU;gBACtC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;YACA;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,UAAU;gBACtC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;YACA;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,YAAY;gBACxC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;SACH;QAED,MAAM,GAAG,UAAU,CAAC,YAAY,KAAK,EAAE,UAAU,CAAC;QAClD,QAAQ,GAAG,CAAC;IAChB;IAEA,iBAAiB;IACjB,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,WAAW,CAAC;IAAE;IACpE,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,YAAY;IAAE;IACpE,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,cAAc;IAAE;IACtE,MAAM,GAAG,UAAU,CAAC,YAAY,QAAQ,EAAE,WAAW,CAAC;QAAE,WAAW,CAAC;IAAE;IAEtE,QAAQ,GAAG,CAAC;AAChB"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/app/api/init-db/route.ts"],"sourcesContent":["// app/api/init-db/route.ts\r\n// Database initialization with employee records\r\n\r\nimport { NextResponse } from 'next/server';\r\nimport { getDatabase, collections } from '@/lib/mongodb';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const db = await getDatabase();\r\n\r\n        // Check if users already exist\r\n        const existingUsers = await db.collection(collections.users).countDocuments();\r\n\r\n        if (existingUsers > 0) {\r\n            return NextResponse.json({\r\n                success: true,\r\n                message: 'Database already initialized',\r\n                userCount: existingUsers,\r\n            });\r\n        }\r\n\r\n        // Create employee accounts\r\n        const employees = [\r\n            {\r\n                username: 'emp001',\r\n                password: await bcrypt.hash('emp001@2024', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-001',\r\n                fullName: 'Rajesh Kumar',\r\n                email: 'rajesh.kumar@cpcb.gov.in',\r\n                department: 'Water Quality Monitoring',\r\n                phone: '+91-9876543210',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'emp002',\r\n                password: await bcrypt.hash('emp002@2024', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-002',\r\n                fullName: 'Priya Sharma',\r\n                email: 'priya.sharma@cpcb.gov.in',\r\n                department: 'Industrial Compliance',\r\n                phone: '+91-9876543211',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'emp003',\r\n                password: await bcrypt.hash('emp003@2024', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-003',\r\n                fullName: 'Amit Patel',\r\n                email: 'amit.patel@cpcb.gov.in',\r\n                department: 'Field Operations',\r\n                phone: '+91-9876543212',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'emp004',\r\n                password: await bcrypt.hash('emp004@2024', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-004',\r\n                fullName: 'Sneha Reddy',\r\n                email: 'sneha.reddy@cpcb.gov.in',\r\n                department: 'Data Analysis',\r\n                phone: '+91-9876543213',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'emp005',\r\n                password: await bcrypt.hash('emp005@2024', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-005',\r\n                fullName: 'Vikram Singh',\r\n                email: 'vikram.singh@cpcb.gov.in',\r\n                department: 'Environmental Safety',\r\n                phone: '+91-9876543214',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'supervisor',\r\n                password: await bcrypt.hash('super@2024', 10),\r\n                role: 'supervisor',\r\n                employeeId: 'SUP-001',\r\n                fullName: 'Dr. Meera Iyer',\r\n                email: 'meera.iyer@cpcb.gov.in',\r\n                department: 'Quality Control',\r\n                phone: '+91-9876543215',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                username: 'admin',\r\n                password: await bcrypt.hash('admin@2024', 10),\r\n                role: 'admin',\r\n                employeeId: 'ADMIN-001',\r\n                fullName: 'Administrator',\r\n                email: 'admin@cpcb.gov.in',\r\n                department: 'IT & Systems',\r\n                phone: '+91-9876543216',\r\n                createdAt: new Date(),\r\n                isActive: true,\r\n            },\r\n        ];\r\n\r\n        // Insert employees\r\n        const result = await db.collection(collections.users).insertMany(employees);\r\n\r\n        // Create indexes\r\n        await db.collection(collections.users).createIndex({ username: 1 }, { unique: true });\r\n        await db.collection(collections.users).createIndex({ employeeId: 1 }, { unique: true });\r\n        await db.collection(collections.users).createIndex({ email: 1 }, { unique: true });\r\n\r\n        await db.collection(collections.alerts).createIndex({ timestamp: -1 });\r\n        await db.collection(collections.alerts).createIndex({ factory_id: 1 });\r\n        await db.collection(collections.alerts).createIndex({ alert_status: 1 });\r\n        await db.collection(collections.alerts).createIndex({ assigned_employee_id: 1 });\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: 'Database initialized successfully',\r\n            employeesCreated: result.insertedCount,\r\n            employees: employees.map(e => ({\r\n                username: e.username,\r\n                employeeId: e.employeeId,\r\n                fullName: e.fullName,\r\n                role: e.role,\r\n            })),\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Database initialization error:', error);\r\n        return NextResponse.json(\r\n            {\r\n                success: false,\r\n                error: 'Failed to initialize database',\r\n                details: error.message,\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}