{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\r\n// MongoDB connection and utilities\r\n\r\nimport { MongoClient, Db } from 'mongodb';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n    throw new Error('Please add your MongoDB URI to .env.local');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\ndeclare global {\r\n    var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n}\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n    // In development mode, use a global variable to preserve the MongoClient across hot reloads\r\n    if (!global._mongoClientPromise) {\r\n        client = new MongoClient(uri, options);\r\n        global._mongoClientPromise = client.connect();\r\n    }\r\n    clientPromise = global._mongoClientPromise;\r\n} else {\r\n    // In production mode, create a new MongoClient\r\n    client = new MongoClient(uri, options);\r\n    clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n\r\n/**\r\n * Get database instance\r\n */\r\nexport async function getDatabase(): Promise<Db> {\r\n    const client = await clientPromise;\r\n    return client.db('water_pollution_db');\r\n}\r\n\r\n/**\r\n * Collections\r\n */\r\nexport const collections = {\r\n    users: 'users',\r\n    alerts: 'alerts',\r\n    readings: 'readings',\r\n};\r\n\r\n/**\r\n * User interface\r\n */\r\nexport interface User {\r\n    _id?: string;\r\n    username: string;\r\n    password: string; // hashed\r\n    role: 'admin' | 'employee';\r\n    employeeId: string;\r\n    createdAt: Date;\r\n}\r\n\r\n/**\r\n * Alert interface (matches CSV structure)\r\n */\r\nexport interface Alert {\r\n    _id?: string;\r\n    timestamp: string;\r\n    reading_id: string;\r\n    factory_id: string;\r\n    factory_type: string;\r\n    location_km_from_origin: number;\r\n    sensor_data: {\r\n        flow_rate_m3ph: number;\r\n        turbidity_ntu: number;\r\n        ph: number;\r\n        conductivity_us_cm: number;\r\n        temperature_c: number;\r\n        chromium_mg_l: number;\r\n        copper_mg_l: number;\r\n        tds_mg_l: number;\r\n        uv_vis_absorbance: number;\r\n    };\r\n    is_violation: boolean;\r\n    violation_reason: string;\r\n    ai_violation_score: number;\r\n    assigned_employee_id: string;\r\n    alert_status: 'none' | 'pending' | 'acknowledged' | 'resolved';\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\n/**\r\n * Reading interface (for real-time submissions)\r\n */\r\nexport interface Reading {\r\n    _id?: string;\r\n    timestamp: string;\r\n    factory_id: string;\r\n    factory_type: string;\r\n    sensor_data: Record<string, number>;\r\n    submitted_by: string;\r\n    createdAt: Date;\r\n}\r\n\r\n/**\r\n * Initialize database with seed data\r\n */\r\nexport async function initializeDatabase() {\r\n    const db = await getDatabase();\r\n\r\n    // Check if users exist\r\n    const usersCount = await db.collection(collections.users).countDocuments();\r\n\r\n    if (usersCount === 0) {\r\n        // Seed users\r\n        const bcrypt = require('bcryptjs');\r\n        const users: User[] = [\r\n            {\r\n                username: 'emp047',\r\n                password: await bcrypt.hash('emp123', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-001',\r\n                createdAt: new Date(),\r\n            },\r\n            {\r\n                username: 'emp048',\r\n                password: await bcrypt.hash('emp123', 10),\r\n                role: 'employee',\r\n                employeeId: 'EMP-002',\r\n                createdAt: new Date(),\r\n            },\r\n            {\r\n                username: 'admin',\r\n                password: await bcrypt.hash('admin123', 10),\r\n                role: 'admin',\r\n                employeeId: 'ADMIN-001',\r\n                createdAt: new Date(),\r\n            },\r\n        ];\r\n\r\n        await db.collection(collections.users).insertMany(users);\r\n        console.log('✓ Seeded users');\r\n    }\r\n\r\n    // Create indexes\r\n    await db.collection(collections.alerts).createIndex({ timestamp: -1 });\r\n    await db.collection(collections.alerts).createIndex({ factory_id: 1 });\r\n    await db.collection(collections.alerts).createIndex({ alert_status: 1 });\r\n    await db.collection(collections.readings).createIndex({ timestamp: -1 });\r\n\r\n    console.log('✓ Database initialized');\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,iBAAiB;AACjB,mCAAmC;AAEnC;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC1B,MAAM,IAAI,MAAM;AACpB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAMJ,wCAA4C;IACxC,4FAA4F;IAC5F,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC7B,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC/C;IACA,gBAAgB,OAAO,mBAAmB;AAC9C;;uCAMe;AAKR,eAAe;IAClB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACrB;AAKO,MAAM,cAAc;IACvB,OAAO;IACP,QAAQ;IACR,UAAU;AACd;AA4DO,eAAe;IAClB,MAAM,KAAK,MAAM;IAEjB,uBAAuB;IACvB,MAAM,aAAa,MAAM,GAAG,UAAU,CAAC,YAAY,KAAK,EAAE,cAAc;IAExE,IAAI,eAAe,GAAG;QAClB,aAAa;QACb,MAAM;QACN,MAAM,QAAgB;YAClB;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,UAAU;gBACtC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;YACA;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,UAAU;gBACtC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;YACA;gBACI,UAAU;gBACV,UAAU,MAAM,OAAO,IAAI,CAAC,YAAY;gBACxC,MAAM;gBACN,YAAY;gBACZ,WAAW,IAAI;YACnB;SACH;QAED,MAAM,GAAG,UAAU,CAAC,YAAY,KAAK,EAAE,UAAU,CAAC;QAClD,QAAQ,GAAG,CAAC;IAChB;IAEA,iBAAiB;IACjB,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,WAAW,CAAC;IAAE;IACpE,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,YAAY;IAAE;IACpE,MAAM,GAAG,UAAU,CAAC,YAAY,MAAM,EAAE,WAAW,CAAC;QAAE,cAAc;IAAE;IACtE,MAAM,GAAG,UAAU,CAAC,YAAY,QAAQ,EAAE,WAAW,CAAC;QAAE,WAAW,CAAC;IAAE;IAEtE,QAAQ,GAAG,CAAC;AAChB"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/app/api/auth/login/route.ts"],"sourcesContent":["// app/api/auth/login/route.ts\r\n// MongoDB authentication\r\n\r\nimport { NextResponse } from 'next/server';\r\nimport { getDatabase, collections } from '@/lib/mongodb';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const { username, password } = await request.json();\r\n\r\n        if (!username || !password) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Username and password required' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const db = await getDatabase();\r\n        const user = await db.collection(collections.users).findOne({ username });\r\n\r\n        if (!user) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Invalid credentials' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        const isValid = await bcrypt.compare(password, user.password);\r\n\r\n        if (!isValid) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Invalid credentials' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Return user data (excluding password)\r\n        const { password: _, ...userData } = user;\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            user: {\r\n                id: user._id.toString(),\r\n                username: user.username,\r\n                role: user.role,\r\n                employeeId: user.employeeId,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error('Login error:', error);\r\n        return NextResponse.json(\r\n            { success: false, error: 'Login failed' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,8BAA8B;AAC9B,yBAAyB;AAEzB;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,IAAI,CAAC,YAAY,CAAC,UAAU;YACxB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;gBAAO,OAAO;YAAiC,GAC1D;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,KAAK,MAAM,IAAA,sIAAW;QAC5B,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,sIAAW,CAAC,KAAK,EAAE,OAAO,CAAC;YAAE;QAAS;QAEvE,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAC/C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAE5D,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAC/C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,wCAAwC;QACxC,MAAM,EAAE,UAAU,CAAC,EAAE,GAAG,UAAU,GAAG;QAErC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;gBACF,IAAI,KAAK,GAAG,CAAC,QAAQ;gBACrB,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,YAAY,KAAK,UAAU;YAC/B;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;YAAO,OAAO;QAAe,GACxC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}