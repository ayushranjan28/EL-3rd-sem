{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/lib/db.ts"],"sourcesContent":["import { sql } from '@vercel/postgres';\r\nimport { Alert, Employee } from './types';\r\n\r\n// Mock Data for Fallback\r\nlet MOCK_ALERTS: Alert[] = [];\r\nlet MOCK_ASSIGNMENTS: any[] = [];\r\n\r\n// Helper to handle both DB and Mock modes seamlessly\r\nexport async function fetchAlerts(): Promise<Alert[]> {\r\n    try {\r\n        // Attempt real DB call\r\n        // Table: alerts (id, factory, timestamp, violation_type, assigned_employee_id, status)\r\n        const { rows } = await sql`SELECT * FROM alerts ORDER BY timestamp DESC LIMIT 50`;\r\n        return rows.map(r => ({\r\n            id: r.id,\r\n            factory: r.factory,\r\n            timestamp: r.timestamp,\r\n            violationType: r.violation_type,\r\n            assignedEmployeeId: r.assigned_employee_id,\r\n            status: r.status\r\n        })) as Alert[];\r\n    } catch (error) {\r\n        console.warn(\"Database connection failed (expected during build/without env vars). Using In-Memory Mock.\");\r\n        return MOCK_ALERTS;\r\n    }\r\n}\r\n\r\nexport async function createAlertInDb(alert: Alert) {\r\n    try {\r\n        await sql`\r\n      INSERT INTO alerts (id, factory, timestamp, violation_type, assigned_employee_id, status)\r\n      VALUES (${alert.id}, ${alert.factory}, ${alert.timestamp}, ${alert.violationType}, ${alert.assignedEmployeeId}, ${alert.status})\r\n    `;\r\n    } catch (error) {\r\n        console.warn(\"DB Write failed, pushing to mock store.\");\r\n        MOCK_ALERTS.unshift(alert);\r\n        if (MOCK_ALERTS.length > 50) MOCK_ALERTS.pop();\r\n    }\r\n}\r\n\r\nexport async function updateAlertStatusInDb(id: string, status: 'Resolved' | 'Active') {\r\n    try {\r\n        await sql`UPDATE alerts SET status=${status} WHERE id=${id}`;\r\n    } catch (error) {\r\n        const idx = MOCK_ALERTS.findIndex(a => a.id === id);\r\n        if (idx !== -1) MOCK_ALERTS[idx].status = status;\r\n    }\r\n}\r\n\r\nexport const EMPLOYEES: Employee[] = [\r\n    { id: 'EMP-001', name: 'Rajesh Kumar', department: 'Field Ops', status: 'Available' },\r\n    { id: 'EMP-012', name: 'Sunita Sharma', department: 'Chemical Analysis', status: 'Available' },\r\n    { id: 'EMP-047', name: 'Amit Verma', department: 'Rapid Response', status: 'Available' },\r\n    { id: 'EMP-089', name: 'Priya Singh', department: 'Compliance', status: 'Available' },\r\n    { id: 'EMP-092', name: 'Vikram Malhotra', department: 'Field Ops', status: 'Available' },\r\n];\r\n\r\nexport async function getRandomEmployee(): Promise<Employee> {\r\n    return EMPLOYEES[Math.floor(Math.random() * EMPLOYEES.length)];\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;;AAGA,yBAAyB;AACzB,IAAI,cAAuB,EAAE;AAC7B,IAAI,mBAA0B,EAAE;AAGzB,eAAe;IAClB,IAAI;QACA,uBAAuB;QACvB,uFAAuF;QACvF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,+MAAG,CAAC,qDAAqD,CAAC;QACjF,OAAO,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;gBAClB,IAAI,EAAE,EAAE;gBACR,SAAS,EAAE,OAAO;gBAClB,WAAW,EAAE,SAAS;gBACtB,eAAe,EAAE,cAAc;gBAC/B,oBAAoB,EAAE,oBAAoB;gBAC1C,QAAQ,EAAE,MAAM;YACpB,CAAC;IACL,EAAE,OAAO,OAAO;QACZ,QAAQ,IAAI,CAAC;QACb,OAAO;IACX;AACJ;AAEO,eAAe,gBAAgB,KAAY;IAC9C,IAAI;QACA,MAAM,+MAAG,CAAC;;cAEJ,EAAE,MAAM,EAAE,CAAC,EAAE,EAAE,MAAM,OAAO,CAAC,EAAE,EAAE,MAAM,SAAS,CAAC,EAAE,EAAE,MAAM,aAAa,CAAC,EAAE,EAAE,MAAM,kBAAkB,CAAC,EAAE,EAAE,MAAM,MAAM,CAAC;IACjI,CAAC;IACD,EAAE,OAAO,OAAO;QACZ,QAAQ,IAAI,CAAC;QACb,YAAY,OAAO,CAAC;QACpB,IAAI,YAAY,MAAM,GAAG,IAAI,YAAY,GAAG;IAChD;AACJ;AAEO,eAAe,sBAAsB,EAAU,EAAE,MAA6B;IACjF,IAAI;QACA,MAAM,+MAAG,CAAC,yBAAyB,EAAE,OAAO,UAAU,EAAE,GAAG,CAAC;IAChE,EAAE,OAAO,OAAO;QACZ,MAAM,MAAM,YAAY,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAChD,IAAI,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,MAAM,GAAG;IAC9C;AACJ;AAEO,MAAM,YAAwB;IACjC;QAAE,IAAI;QAAW,MAAM;QAAgB,YAAY;QAAa,QAAQ;IAAY;IACpF;QAAE,IAAI;QAAW,MAAM;QAAiB,YAAY;QAAqB,QAAQ;IAAY;IAC7F;QAAE,IAAI;QAAW,MAAM;QAAc,YAAY;QAAkB,QAAQ;IAAY;IACvF;QAAE,IAAI;QAAW,MAAM;QAAe,YAAY;QAAc,QAAQ;IAAY;IACpF;QAAE,IAAI;QAAW,MAAM;QAAmB,YAAY;QAAa,QAAQ;IAAY;CAC1F;AAEM,eAAe;IAClB,OAAO,SAAS,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,UAAU,MAAM,EAAE;AAClE"}},
    {"offset": {"line": 219, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ayush/Desktop/Main%20EL%203rd%20sem/cpcb-dashboard/src/app/api/alerts/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { fetchAlerts, createAlertInDb, updateAlertStatusInDb } from '@/lib/db';\r\nimport { Alert } from '@/lib/types';\r\n\r\nexport async function GET() {\r\n    const alerts = await fetchAlerts();\r\n    return NextResponse.json(alerts);\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    const body = await request.json();\r\n\r\n    if (body.action === 'create') {\r\n        const newAlert: Alert = body.alert;\r\n        await createAlertInDb(newAlert);\r\n        return NextResponse.json({ success: true });\r\n    }\r\n\r\n    if (body.action === 'resolve') {\r\n        const { id } = body;\r\n        await updateAlertStatusInDb(id, 'Resolved');\r\n        return NextResponse.json({ success: true });\r\n    }\r\n\r\n    return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe;IAClB,MAAM,SAAS,MAAM,IAAA,sJAAW;IAChC,OAAO,qKAAY,CAAC,IAAI,CAAC;AAC7B;AAEO,eAAe,KAAK,OAAgB;IACvC,MAAM,OAAO,MAAM,QAAQ,IAAI;IAE/B,IAAI,KAAK,MAAM,KAAK,UAAU;QAC1B,MAAM,WAAkB,KAAK,KAAK;QAClC,MAAM,IAAA,0JAAe,EAAC;QACtB,OAAO,qKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C;IAEA,IAAI,KAAK,MAAM,KAAK,WAAW;QAC3B,MAAM,EAAE,EAAE,EAAE,GAAG;QACf,MAAM,IAAA,gKAAqB,EAAC,IAAI;QAChC,OAAO,qKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C;IAEA,OAAO,qKAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;AACxE"}}]
}